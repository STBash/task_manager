<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager</title>
</head>
<body>
    <h1>Task Manager</h1>

    <h2>Dodaj u≈ºytkownika</h2>
    <input type="text" id="username" placeholder="Nazwa u≈ºytkownika">
    <button onclick="addUser()">Dodaj u≈ºytkownika</button>

    <h2>Dodaj zadanie</h2>
    <input type="text" id="taskTitle" placeholder="Tytu≈Ç zadania">
    <input type="text" id="taskDescription" placeholder="Opis zadania">
    <select id="taskUser">
        <option value="">Wybierz u≈ºytkownika</option>
    </select>
    <button onclick="addTask()">Dodaj zadanie</button>

    <h2>Lista zada≈Ñ</h2>
    <ul id="taskList"></ul>

    <script>
        const apiUrl = 'http://localhost:5008/api';

        // Pobiera listƒô u≈ºytkownik√≥w i aktualizuje dropdown
        function fetchUsers() {
            fetch(`${apiUrl}/users`)
                .then(response => response.json())
                .then(users => {
                    const userSelect = document.getElementById('taskUser');
                    userSelect.innerHTML = '<option value="">Wybierz u≈ºytkownika</option>';
                    users.forEach(user => {
                        const option = document.createElement('option');
                        option.value = user.id;
                        option.textContent = user.name;
                        userSelect.appendChild(option);
                    });
                })
                .catch(error => console.error('B≈ÇƒÖd pobierania u≈ºytkownik√≥w:', error));
        }

        // Pobiera i wy≈õwietla listƒô zada≈Ñ
        function fetchTasks() {
            fetch(`${apiUrl}/tasks`)
                .then(response => response.json())
                .then(tasks => {
                    const taskList = document.getElementById('taskList');
                    taskList.innerHTML = '';
                    tasks.forEach(task => {
                        const listItem = document.createElement('li');
                        listItem.innerHTML = `
                            <strong>${task.title}</strong> - ${task.description}
                            <br>U≈ºytkownik: ${task.user ? task.user.name : 'Brak'}
                            <br>Status: ${task.isCompleted ? '‚úî Uko≈Ñczone' : '‚ùå W toku'}
                            <br>
                            <button onclick="completeTask(${task.id})">‚úî Oznacz jako uko≈Ñczone</button>
                            <button onclick="deleteTask(${task.id})">üóë Usu≈Ñ</button>
                        `;
                        taskList.appendChild(listItem);
                    });
                })
                .catch(error => console.error('B≈ÇƒÖd pobierania zada≈Ñ:', error));
        }

        // Dodaje nowego u≈ºytkownika
        function addUser() {
            const name = document.getElementById('username').value;
            if (!name) return alert('Wpisz nazwƒô u≈ºytkownika');

            fetch(`${apiUrl}/users`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name })
            })
            .then(response => response.json())
            .then(() => {
                fetchUsers();
                alert('Dodano u≈ºytkownika!');
            })
            .catch(error => console.error('B≈ÇƒÖd dodawania u≈ºytkownika:', error));
        }

        // Dodaje nowe zadanie
        function addTask() {
            const title = document.getElementById('taskTitle').value;
            const description = document.getElementById('taskDescription').value;
            const userId = document.getElementById('taskUser').value;

            if (!title || !description) return alert('Wpisz tytu≈Ç i opis zadania');

            fetch(`${apiUrl}/tasks`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title, description, userId: userId || null })
            })
            .then(response => response.json())
            .then(() => {
                fetchTasks();
                alert('Dodano zadanie!');
            })
            .catch(error => console.error('B≈ÇƒÖd dodawania zadania:', error));
        }

        // Oznacza zadanie jako uko≈Ñczone
        function completeTask(taskId) {
            fetch(`${apiUrl}/tasks/${taskId}/complete`, { method: 'PUT' })
                .then(() => fetchTasks())
                .catch(error => console.error('B≈ÇƒÖd oznaczania jako uko≈Ñczone:', error));
        }

        // Usuwa zadanie
        function deleteTask(taskId) {
            fetch(`${apiUrl}/tasks/${taskId}`, { method: 'DELETE' })
                .then(() => fetchTasks())
                .catch(error => console.error('B≈ÇƒÖd usuwania zadania:', error));
        }

        // Wczytaj u≈ºytkownik√≥w i zadania na starcie
        fetchUsers();
        fetchTasks();
    </script>
</body>
</html>
